#!/bin/bash

ALERT_FILE=$1
HOOK_URL="https://discord.com/api/webhooks/1463106734737457335/ME4G0WeOnX3wv-t9_8dUSAh8F7jabAyemA9jyTe0URPJqw5O8_p8K-hM>

if [ ! -f "$ALERT_FILE" ]; then
    exit 1
fi

python3 -c "
import sys, json, re

try:
    with open('$ALERT_FILE', 'r') as f:
        alert_json = json.load(f)
except:
    sys.exit(1)

rule_id = str(alert_json.get('rule', {}).get('id', 'N/A'))
level = alert_json.get('rule', {}).get('level', 0)
description = alert_json.get('rule', {}).get('description', 'No description')
agent_name = alert_json.get('agent', {}).get('name', 'N/A')
timestamp = alert_json.get('timestamp', '')

color = 3066993 #biru
if level >= 10:
    color = 15158332 #merah
elif level >= 5:
    color = 15105570 #oren

discord_payload = {
    'username': 'Wazuh Security',
    'embeds': [{
        'title': f'ðŸš¨ Wazuh Alert - Level {level}',
        'description': description,
        'color': color,
        'fields': [
            {'name': 'Agent', 'value': agent_name, 'inline': True},
            {'name': 'Rule ID', 'value': rule_id, 'inline': True}
        ],
        'footer': {'text': timestamp}
    }]
}

print(json.dumps(discord_payload))
" | curl -s -H "Content-Type: application/json" -d @- "$HOOK_URL"

